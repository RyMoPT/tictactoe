<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <head>
<title>Project: TicTacToe</title>
<link rel="stylesheet" type="text/css" href="style.css" />

<style>
.container {
    background-color: black;
    margin:auto;
    display:grid;
    height: 430px;
    width: 400px;
    grid-gap: 10px;
    grid-template-rows: repeat(4, 100px);
    grid-template-columns: repeat(3, 134px);
    grid-template-areas: 
        "display display display"
        "box1 box2 box3"
        "box4 box5 box6"
        "box7 box8 box9"
}
.box1 {
    grid-area: box1;
    background-color: white;
    font-size: 100px;
    text-align: center;

}
.box2 {
    grid-area: box2;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box3 {
    grid-area: box3;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box4 {
    grid-area: box4;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box5 {
    grid-area: box5;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box6 {
    grid-area: box6;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box7 {
    grid-area: box7;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box8 {
    grid-area: box8;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box9 {
    grid-area: box9;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.display {
    grid-area: display;
    background-color: aquamarine;
    height: 110px;
    width: 400px;
}
.resetBtn {
    display: none;
}
.resetBtnDiv {
    text-align: center;
    padding-top: 30px;

}
h1 {
    padding-top: 30px;
    text-align: center;
}

</style>
    </head>
    <body>
        <div class="container">
                <div class='display'></div>
                <div class="box1 box" id = '0, 0'></div>
                <div class="box2 box" id = '0, 1'></div>
                <div class="box3 box" id = '0, 2'></div>
                <div class="box4 box" id = '1, 0'></div>
                <div class="box5 box" id = '1, 1'></div>
                <div class="box6 box" id = '1, 2'></div>
                <div class="box7 box" id = '2, 0'></div>
                <div class="box8 box" id = '2, 1'></div>
                <div class="box9 box" id = '2, 2'></div>
            </div>
            <div class="resetBtnDiv">
            <button class="resetBtn">Play again?</button>
            </div>
    <script> 

const display = document.querySelector('.display');
const resetBtn = document.querySelector('.resetBtn');
resetBtn.addEventListener('click', function (e) {
    resetBoard();
})

const resetBoard = () => {
let boxesArray = [...boxes];
    boxesArray.forEach(function(e) {
    e.innerText='';
})
display.innerText='';
gameBoard.playerMoves = [
                            [,,,],
                            [,,,],
                            [,,,]
                            ];
console.log(gameBoard.playerMoves);
resetBtn.style.display= 'none';
}


const players = (name) => {
    const getName = () => name;
    const sayName = () => console.log(`My name is ${name}`);
    return {getName, sayName}
}

const playerOne = players('playerOne');
const playerTwo = players('playerTwo');

const gameBoard = (() => {
    let playerMoves = [
        [,,,],
        [,,,],
        [,,,]
    ];
    return {playerMoves};
    
})();

const boxes = document.querySelectorAll('.box')

const gameFlow = (() => {
    const playerOneMove = () => {
        return 'x';
    }
    const playerTwoMove = () => {
    let boxesArray = [...boxes];
    let emptySpaces=[]
    boxesArray.forEach(function(e) {
        if (e.innerText === '') {
            emptySpaces.push(e.id);
        }
    }  
)
        let nextPosition = emptySpaces[Math.floor(Math.random()*emptySpaces.length)];
        if (nextPosition === undefined) {
            display.innerText= 'TIE GAME';
            resetBtn.style.display = 'inline';
        } else {
        let nextPositionX = nextPosition.slice(0,1);
        let nextPositionY = nextPosition.slice(3);
        console.log(nextPositionX,nextPositionY);
        gameBoard.playerMoves[nextPositionX][nextPositionY] = 'o';
        boxesArray.forEach(function(e) {
            if (e.id === nextPosition) {
                e.innerText='o';
                
        }})}
    } 
    return {playerOneMove,playerTwoMove}
})();

const checkWinner = () => {
    if  (gameBoard.playerMoves[0][0]!= null && gameBoard.playerMoves[0][0] == gameBoard.playerMoves[0][1] && gameBoard.playerMoves[0][0]== gameBoard.playerMoves[0][2]) {
        const winner = gameBoard.playerMoves[0][0];
        const status = true;
        return {status, winner};
    } else if (gameBoard.playerMoves[1][0]!= null && gameBoard.playerMoves[1][0] == gameBoard.playerMoves[1][1] && gameBoard.playerMoves[1][0]== gameBoard.playerMoves[1][2]) {
        const winner = gameBoard.playerMoves[1][0];
        const status = true;
        return {status, winner};
    }else if (gameBoard.playerMoves[2][0]!= null && gameBoard.playerMoves[2][0] == gameBoard.playerMoves[2][1] && gameBoard.playerMoves[2][0]== gameBoard.playerMoves[2][2]) {
        const winner = gameBoard.playerMoves[2][0];
        const status = true;
        return {status, winner};
    }else if (gameBoard.playerMoves[0][0]!= null && gameBoard.playerMoves[0][0] == gameBoard.playerMoves[1][1] && gameBoard.playerMoves[0][0]== gameBoard.playerMoves[2][2]) {
        const winner = gameBoard.playerMoves[0][0];
        const status = true;
        return {status, winner};
    }else if (gameBoard.playerMoves[2][0]!= null && gameBoard.playerMoves[2][0] == gameBoard.playerMoves[1][1] && gameBoard.playerMoves[2][0]== gameBoard.playerMoves[0][2]) {
        const winner = gameBoard.playerMoves[2][0];
        const status = true;
        return {status, winner};
    }else if (gameBoard.playerMoves[0][1]!= null && gameBoard.playerMoves[0][1] == gameBoard.playerMoves[1][1] && gameBoard.playerMoves[0][1]== gameBoard.playerMoves[2][1]) {
        const winner = gameBoard.playerMoves[0][1];
        const status = true;
        return {status, winner};
    }else if (gameBoard.playerMoves[0][0]!= null && gameBoard.playerMoves[0][0] == gameBoard.playerMoves[1][0] && gameBoard.playerMoves[0][0]== gameBoard.playerMoves[2][0]) {
        const winner = gameBoard.playerMoves[0][0];
        const status = true;
        return {status, winner};
    }else if (gameBoard.playerMoves[0][2]!= null && gameBoard.playerMoves[0][2] == gameBoard.playerMoves[1][2] && gameBoard.playerMoves[0][2]== gameBoard.playerMoves[2][2]) {
        const winner = gameBoard.playerMoves[0][2];
        const status = true;
        return {status, winner};
    }
    else {
        return false;
    }
}

const displayController = (() => {

    //add event listener to all boxes
    for (i = 0; boxes.length > 0; i++) {        
        boxes[i].addEventListener('click', (e) => {
            // make it so that you can't click boxes that have already been clicked
        if (e.target.innerText === 'x' || e.target.innerText === 'o') {
            console.log('no you cant click this')
            return;
        //making sure that if someone has one, you cannot make any further changes to the board
        }else if (checkWinner().status==true && e.target.innerText === ''){
            console.log('help')
            return;
        } else {
            //player one makes a move and X appears on box they clicked
            display.innerText='';
            console.log(e.target.innerText);
            e.target.innerText = gameFlow.playerOneMove();
            console.log(e.target.innerText);
            console.log(e.target.id);
            //finding the X and Y coordinates of box
            let arrayNavX = e.target.id.slice(0,1);
            console.log(arrayNavX);
            let arrayNavY = e.target.id.slice(3);
            console.log(arrayNavY);
            // puts the X and Y coordinates into the gameBoard.playerMoves 2d array
            gameBoard.playerMoves[arrayNavX][arrayNavY] = e.target.innerText
            console.log(checkWinner())
            // checks to see if there was a winner and displays the according text and reset button
            if (checkWinner().status == true) {
                console.log('somebody won');
                display.innerText = `Da winner was ${checkWinner().winner}`
                resetBtn.style.display = 'inline';
                console.log(boxes);
                console.log(boxes.length);
                return;
            }
            // checks if there was no winner. If not, player 2 is allowed to move then there is a check for a winner again.
            else if (checkWinner()==false) {
                        gameFlow.playerTwoMove();
                        if (checkWinner().status == true) {
                        display.innerText = `Da winner was ${checkWinner().winner}`
                        resetBtn.style.display = 'inline';
                            return;
                        }
                        
                }
                else return;
            }
        })}
})();



    </script>
    </body>
    <footer>
        <h1>Designed by <a href='https://github.com/RyMoPT'>RyMoPT</a></h1>
    </footer>
</html>