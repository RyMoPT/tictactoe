<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <head>
<title>Project: TicTacToe</title>
<link rel="stylesheet" type="text/css" href="style.css" />
<link href='https://fonts.googleapis.com/css?family=Architects Daughter' rel='stylesheet'>
<style>
.container {
    background-color: black;
    font-family: 'Architects Daughter';
    margin:auto;
    display:grid;
    line-height: 1;
    height: 320px;
    width: 410px;
    grid-gap: 10px;
    grid-template-rows: repeat(3, 100px);
    grid-template-columns: repeat(3, 130px);
    grid-template-areas: 
        "box1 box2 box3"
        "box4 box5 box6"
        "box7 box8 box9"
}
.box1 {
    grid-area: box1;
    background-color: white;
    font-size: 100px;
    text-align: center;

}
.box2 {
    grid-area: box2;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box3 {
    grid-area: box3;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box4 {
    grid-area: box4;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box5 {
    grid-area: box5;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box6 {
    grid-area: box6;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box7 {
    grid-area: box7;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box8 {
    grid-area: box8;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.box9 {
    grid-area: box9;
    background-color: white;
    font-size: 100px;
    text-align: center;
}
.topdisplay {
    background-color: white;
    height: 80px;
    width: 400px;
    margin: auto;
    font-size: 40px;
    text-align: center;
    font-family: 'Architects Daughter';
    line-height: 2;

}
.resetBtn {
    visibility: hidden;
    border: none;
    font-family: 'Architects Daughter';
    font-size: 30px;
    box-shadow: 5px 7px;
    margin-bottom: 10px;
}
.resetBtn:hover {
    border: none;
    font-family: 'Architects Daughter';
    font-size: 30px;
    box-shadow: 5px 7px;
    transform: scale(1.2)
}
.resetBtnDiv {
    text-align: center;
    padding-top: 30px;


}
h1 {
    text-align: center;
    font-size: 10px;
    font-family: 'Architects Daughter';
}
.playerInfo {
    text-align: center;
    font-size: 20px;
    font-family: 'Architects Daughter';
}
p {
    margin: 0px;
}
.winColour {
    color: red;
}

</style>
    </head>
    <body>
        <div class="topdisplay"><strong>Tic Tac Toe!</strong></div>
        <div class="container">
                <div class="box1 box" id = '0 0'></div>
                <div class="box2 box" id = '0 1'></div>
                <div class="box3 box" id = '0 2'></div>
                <div class="box4 box" id = '1 0'></div>
                <div class="box5 box" id = '1 1'></div>
                <div class="box6 box" id = '1 2'></div>
                <div class="box7 box" id = '2 0'></div>
                <div class="box8 box" id = '2 1'></div>
                <div class="box9 box" id = '2 2'></div>
            </div>
            <div class="resetBtnDiv">
            <button class="resetBtn">Play again?</button>
            </div>
            <div class="playerInfo">
                <p>Human = [X] <br>
                CPU = [O]</p>
            </div>
    <script> 

const topDisplay = document.querySelector('.topdisplay');
const resetBtn = document.querySelector('.resetBtn');
resetBtn.addEventListener('click', function (e) {
    resetBoard();
})

const resetBoard = () => {
let boxesArray = [...boxes];
    boxesArray.forEach(function(e) {
    e.innerText='';
    e.classList.remove('winColour');
})
topDisplay.innerText='';
gameBoard.playerMoves = [
                            [,,,],
                            [,,,],
                            [,,,]
                            ];
console.log(gameBoard.playerMoves);
resetBtn.style.visibility= 'hidden';
}


// const players = (name) => {
//     const getName = () => name;
//     const sayName = () => console.log(`My name is ${name}`);
//     return {getName, sayName}
// }

// const playerOne = players('playerOne');
// const playerTwo = players('playerTwo');

const gameBoard = (() => {
    let playerMoves = [
        [,,,],
        [,,,],
        [,,,]
    ];
    return {playerMoves};
    
})();

const boxes = document.querySelectorAll('.box')

const gameFlow = (() => {
    const playerOneMove = () => {
        return 'X';
    }
    const playerTwoMove = () => {
        //finds all boxes in DOM nodelist then makes it into an array so it can be properly used later
    let boxesArray = [...boxes];
    // initialize empty array to be able to push IDs (xy coordinates) of boxes
    let emptySpaces=[]
    // only pushes xy coordinates of empty boxes into emptySpaces array that have not yet been clicked
    boxesArray.forEach(function(e) {
        if (e.innerText === '') {
            emptySpaces.push(e.id);
        }
    }  
)
// finds random empty box within the emptySpaces array
        let nextPosition = emptySpaces[Math.floor(Math.random()*emptySpaces.length)];
        // checks to see if an empty box was actually found in the emptySpace array, if not then that means 
        // there are no more boxes available and it has become a tie game
        if (nextPosition === undefined) {
            topDisplay.innerText= 'TIE GAME';
            resetBtn.style.visibility = 'visible';
        } else {
            //if an empty box was found, take x and y coordinates
        let nextPositionX = nextPosition.slice(0,1);
        let nextPositionY = nextPosition.slice(2);
        console.log(nextPositionX,nextPositionY);
        //adds the letter o to that position in the array holding the data
        gameBoard.playerMoves[nextPositionX][nextPositionY] = 'O';
        //displays that same o onto the HTML tictactoe box
        window.setTimeout(() =>{
        boxesArray.forEach( (e) => {
            if (e.id === nextPosition) {
                e.innerText='O';
        }})
    }, 250)
    }
    } 
    return {playerOneMove,playerTwoMove}
})();

const compare = (a,b,c,) => {
    return a!= null && a ==b && a == c
}
const changeColour = (coords) => {
    //takes winning coordinates and makes it into array 
    let separatedCoords = coords.split(',');
    console.log(separatedCoords)
    for (i = 0; i < 3; i++){
    //compares the ID (DOM coordinates) to the winning coords, if there is a match then change the colours of those boxes
    let boxesArray = [...boxes];
    boxesArray.forEach(function(e) {
        console.log(e.id)
        if (e.id === separatedCoords[i]){
        e.classList.add('winColour')
    }
})
}
}

const checkWinner = () => {
//checking matching boxes vertically
    for (let i = 0; i < 3; i++){
if (compare(gameBoard.playerMoves[0][i],gameBoard.playerMoves[1][i], gameBoard.playerMoves[2][i])) {
        const winner = gameBoard.playerMoves[0][i];
        const status = true;
        const winCoords = `0 ${[i]},1 ${[i]},2 ${[i]}`;
        console.log('winning down')
        console.log(winCoords);
        changeColour(winCoords);
        return {status, winner, winCoords};
}}
//checking matching boxes horizontally
for (let i = 0; i < 3; i++){
 if (compare(gameBoard.playerMoves[i][0],gameBoard.playerMoves[i][1], gameBoard.playerMoves[i][2])){
        const winner = gameBoard.playerMoves[i][0];
        const status = true;
        console.log('winning across')
        const winCoords = `${[i]} 0,${[i]} 1,${[i]} 2`;
        changeColour(winCoords);
        return {status, winner};
}}
 //checking diagonally
    if (gameBoard.playerMoves[0][0]!= null && gameBoard.playerMoves[0][0] == gameBoard.playerMoves[1][1] && gameBoard.playerMoves[0][0]== gameBoard.playerMoves[2][2]) {
        const winner = gameBoard.playerMoves[0][0];
        const status = true;
        const winCoords = `0 0,1 1,2 2`;
        changeColour(winCoords);
        return {status, winner};
        }
    else if (gameBoard.playerMoves[2][0]!= null && gameBoard.playerMoves[2][0] == gameBoard.playerMoves[1][1] && gameBoard.playerMoves[2][0]== gameBoard.playerMoves[0][2]) {
        const winner = gameBoard.playerMoves[2][0];
        const status = true;
        const winCoords = `2 0,1 1,0 2`;
        changeColour(winCoords);
        return {status, winner};
        }
    else {
        return false;
    }
}

const displayController = (() => {

    //add event listener to all boxes
    for (i = 0; boxes.length > 0; i++) {        
        boxes[i].addEventListener('click', (e) => {
            // make it so that you can't click boxes that have already been clicked
        if (e.target.innerText === 'X' || e.target.innerText === 'O') {
            console.log('no you cant click this')
            return;
        //making sure that if someone has one, you cannot make any further changes to the board by clicking an open spot
        }else if (checkWinner().status==true && e.target.innerText === ''){
            console.log('cant click this either')
            return;
        } else {
            //player one makes a move and X appears on box they clicked
            topDisplay.innerText='';
            e.target.innerText = gameFlow.playerOneMove();
            //finding the X and Y coordinates of box that was clicked
            let arrayNavX = e.target.id.slice(0,1);
            let arrayNavY = e.target.id.slice(2);
            // puts the X and Y coordinates into the gameBoard.playerMoves 2d array
            gameBoard.playerMoves[arrayNavX][arrayNavY] = e.target.innerText
            // checks to see if there was a winner and displays the according text and reset button
            if (checkWinner().status == true) {
                console.log('somebody won');
                topDisplay.innerText = `${checkWinner().winner} WINS!`
                resetBtn.style.visibility = 'visible';
                console.log(boxes);
                console.log(boxes.length);
                return;
            }
            // checks if there was no winner. If not, player 2 is allowed to move then there is a check for a winner again.
            else if (checkWinner()==false) {
                        gameFlow.playerTwoMove();
                        if (checkWinner().status == true) {
                        topDisplay.innerText = `${checkWinner().winner} WINS!`
                        resetBtn.style.visibility = 'visible';
                            return;
                        }
                        
                }
                else return;
            }
        })}
})();



    </script>
    </body>
    <footer>
        <h1>Designed by <a href='https://github.com/RyMoPT'>RyMoPT</a></h1>
    </footer>
</html>